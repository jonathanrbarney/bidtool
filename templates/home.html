{% extends 'base.html' %}
{% load leaflet_tags %}

{% block nav %}
<div id ='header'>
<nav class="navbar navbar-dark bg-dark">
  <a class=" text-white navbar-brand">BidTool</a>
    <div class="container w-100">
    <form class="w-100 form-inline m-2" method="get" id="filter">
        <div class="row p-0 m-0 w-100">
        <select name="country" id="country" class="selectpicker form-control m-2 col-sm-6" multiple data-live-search="true" title="Filter By Location">
            {% for i in countries %}
            {% if i in selected %}
            <option selected="selected">{{i}}</option>
            {%else%}
            <option>{{i}}</option>
            {%endif%}
            {% endfor %}
            </select>
      <input class="form-control m-2 w-100 col-sm-4" name="name" type="search" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-success m-2 w-100 col-sm-1" type="submit">Search</button>
        </div>
    </form>
        </div>
</nav>
    </div>

{% endblock %}

{% block content %}
<script type="text/javascript">
var mapper;
var mark;
var group;
        function map_init_basic (map, options) {
        mapper=map;
        track=0;
        arr=[];
        {% for embassy in embassies %}
        var latlng = L.latLng(Number({{embassy.latitude}}), Number({{embassy.longitude}}));
        var marker = L.marker(latlng);
        arr.push(marker)
        track=track+1;
        marker.bindPopup('<p>{{embassy.name}}<br /><a href="{{embassy.website}}">{{embassy.website}}</a></p>');
    {% endfor %}
    if(track==1){
    marker.addTo(map);
    map.setView([marker.getLatLng().lat,marker.getLatLng().lng], 13);
    }else{
group = L.featureGroup(arr).addTo(map);
map.fitBounds(group.getBounds());
}

}
</script>


{% leaflet_map "map" callback="window.map_init_basic" %}

{% endblock %}
{% block scripts %}
<script>
$(function () {
    "use strict";
    var resizeDiv = function (object) {
        object.height($(window).height() - $('#header').height());
    };


    $(window).ready(function () {
        resizeDiv($('#map'));
        mapper.invalidateSize();
        mapper.fitBounds(group.getBounds());
    });

    $(window).bind("resize", function () {
        resizeDiv($('#map'));
        mapper.invalidateSize()

    });

});
</script>

<script>
$('select').selectpicker();
</script>
{% endblock %}